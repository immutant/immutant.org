<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>Immutant 2.1.2 API documentation</title><link href="assets/immutant.css" rel="stylesheet" type="text/css"></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Immutant 2.1.2 API documentation</a></h1></div><div class="sidebar" id="namespaces"><div id="guides"><h3><a href="index.html"><span class="inner">Guides</span></a></h3><ul><li class="guide Migration-current"><a href="guide-migration.html"><div class="inner"><span>Migration</span></div></a></li><li class="guide Installation-current"><a href="guide-installation.html"><div class="inner"><span>Installation</span></div></a></li><li class="guide Web-current"><a href="guide-web.html"><div class="inner"><span>Web</span></div></a></li><li class="guide Messaging-current"><a href="guide-messaging.html"><div class="inner"><span>Messaging</span></div></a></li><li class="guide Scheduling-current"><a href="guide-scheduling.html"><div class="inner"><span>Scheduling</span></div></a></li><li class="guide Caching-current"><a href="guide-caching.html"><div class="inner"><span>Caching</span></div></a></li><li class="guide Transactions-current"><a href="guide-transactions.html"><div class="inner"><span>Transactions</span></div></a></li><li class="guide WildFly-current"><a href="guide-wildfly.html"><div class="inner"><span>WildFly</span></div></a></li><li class="guide current"><a href="guide-EAP.html"><div class="inner"><span>EAP 6.4.x</span></div></a></li><li class="guide Logging-current"><a href="guide-logging.html"><div class="inner"><span>Logging</span></div></a></li></ul></div><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>immutant</span></div></div></li><li class="depth-2"><a href="immutant.caching.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caching</span></div></a></li><li class="depth-3 branch"><a href="immutant.caching.core-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-cache</span></div></a></li><li class="depth-3"><a href="immutant.caching.core-memoize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-memoize</span></div></a></li><li class="depth-2"><a href="immutant.codecs.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>codecs</span></div></a></li><li class="depth-3"><a href="immutant.codecs.fressian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fressian</span></div></a></li><li class="depth-2 branch"><a href="immutant.coercions.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>coercions</span></div></a></li><li class="depth-2 branch"><a href="immutant.daemons.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>daemons</span></div></a></li><li class="depth-2"><a href="immutant.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="immutant.messaging.hornetq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hornetq</span></div></a></li><li class="depth-3"><a href="immutant.messaging.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li><li class="depth-2"><a href="immutant.scheduling.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>scheduling</span></div></a></li><li class="depth-3 branch"><a href="immutant.scheduling.joda.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda</span></div></a></li><li class="depth-3"><a href="immutant.scheduling.quartz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>quartz</span></div></a></li><li class="depth-2"><a href="immutant.transactions.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>transactions</span></div></a></li><li class="depth-3 branch"><a href="immutant.transactions.jdbc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jdbc</span></div></a></li><li class="depth-3"><a href="immutant.transactions.scope.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scope</span></div></a></li><li class="depth-2 branch"><a href="immutant.util.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="immutant.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.sse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sse</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.ssl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ssl</span></div></a></li><li class="depth-3"><a href="immutant.web.undertow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>undertow</span></div></a></li><li class="depth-2"><a href="immutant.wildfly.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>wildfly</span></div></a></li></ul></div><div class='namespace-index guide' id='content'><div class='markdown doc'><div class="guide-content"><h1>EAP 6.4.x Guide</h1><div class="description"><span>Deploying your app to Red Hat JBoss Enterprise Application Platform 6.4.x</span></div><div id="toc"><ul><li><a href="#h5353"><span>Messaging</span></a></li><li><a href="#h5354"><span>Transactions</span></a></li><li><a href="#h5355"><span>Web</span></a></li><li><a href="#h5356"><span>Caching</span></a></li><li><a href="#h5357"><span>Detecting EAP at runtime</span></a></li><li><a href="#h5358"><span>Doing it all from a profile</span></a></li></ul></div><p><a href="http://www.jboss.org/products/eap/overview/">Red Hat JBoss Enterprise Application Platform</a> (EAP for short) is the commercial product built on the open source JBoss application server. The current version (6.4.x) is based on a JBoss AS version that predates WildFly, so has some component differences with WildFly and Immutant itself. However, starting with Immutant 2.1.0, you can now deploy Immutant applications to EAP the same way you can to <a href="guide-wildfly.html">WildFly</a>, with some caveats.</p><h2 id="h5353">Messaging</h2><p>EAP 6.4.x uses an older version of HornetQ (2.3.25 vs. 2.4.5 brought in by Immutant). If you are using <code>org.immutant/messaging</code>, you&rsquo;ll need to exclude its version of HornetQ and bring in the version being used in EAP:</p>
<pre><code>:exclusions [org.hornetq/hornetq-jms-server org.hornetq/hornetq-server]
:dependencies [[org.hornetq/hornetq-jms-server &quot;2.3.25.Final&quot;]
               [org.hornetq/hornetq-server &quot;2.3.25.Final&quot;]]
</code></pre><h2 id="h5354">Transactions</h2><p>EAP 6.4.x uses a version of Narayana (4.17.29 vs. 5.0.3 brought in by Immutant). If you are using <code>org.immutant/transactions</code>, you&rsquo;ll need to exclude its version of Narayana and bring in the version being used in EAP (note the different groupId):</p>
<pre><code>:exclusions [org.jboss.narayana.jta/narayana-jta]
:dependencies [[org.jboss.jbossts.jta/narayana-jta &quot;4.17.29.Final&quot;]]
</code></pre><p>If you are connecting external clients to the HornetQ inside EAP, you must <em>not</em> set the <code>:remote-type</code> option to <code>:hornetq-wildfly</code> in the options passed to <a href="immutant.messaging.html#var-context">immutant.messaging/context</a> and will need to set the <code>:port</code> option to <code>5445</code> as EAP doesn&rsquo;t support WildFly&rsquo;s protocol multiplexing over HTTP.</p><h2 id="h5355">Web</h2><p>EAP 6.4.x uses <a href="http://jbossweb.jboss.org/">jbossweb</a> as its web/servlet server instead of <a href="http://undertow.io/">Undertow</a> (which Immutant uses standalone, and is the web/servlet server inside WildFly). The behavior of web requests in EAP should be the same as WildFly, but you&rsquo;ll need to do a couple of extra configuration steps if you intend to use Websockets.</p><p>First, you need to change the configuration of EAP itself (in <code>standalone/configuration/standalone*.xml</code>) to use a different protocol in the web subsystem. To do so, change:</p>
<pre><code>&lt;connector name=&quot;http&quot; protocol=&quot;HTTP/1.1&quot; scheme=&quot;http&quot; socket-binding=&quot;http&quot;/&gt;
</code></pre><p>to</p>
<pre><code>&lt;connector name=&quot;http&quot; protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot; scheme=&quot;http&quot; socket-binding=&quot;http&quot;/&gt;
</code></pre><p>Second, you&rsquo;ll need to include a custom <code>jboss-web.xml</code> file in the generated WAR file that enables Websockets for the deployment. The file needs to be under <code>WEB-INF/jboss-web.xml</code>, and contain:</p>
<pre><code>&lt;jboss-web&gt;
  &lt;enable-websockets&gt;true&lt;/enable-websockets&gt;
&lt;/jboss-web&gt;
</code></pre><p>The easiest way to do this is to use the <a href="https://github.com/immutant/lein-immutant/blob/master/docs/deployment.md"><code>:war-resources</code> option of the <code>lein-immutant</code> plugin</a>. Note that a WAR with the above contents <em>can&rsquo;t</em> be deployed to a WildFly server, as <code>enable-websockets</code> isn&rsquo;t a valid option there, unfortunately.</p><h2 id="h5356">Caching</h2><p>Immutant&rsquo;s caching library is designed to work with different major versions of Infinispan, including 5, 6, 7 and 8. EAP 6.4 includes Infinispan 5, which is relatively old with some known issues. Three things, in particular:</p>
<ul>
  <li><a href="https://issues.jboss.org/browse/IMMUTANT-454">IMMUTANT-454</a> is not  fixed in EAP 6.4</li>
  <li>Because it lacks support for <code>Equivalence</code> functions, binary keys are  stored in wrappers, a common Infinispan technique prior to version 6.  This limits your ability to read/write values in a cache with  different encodings, which is something nobody should ever do  anyway.</li>
  <li>Events are a little broken in Infinispan 5. Specifically, neither  the <code>:pre?</code> nor <code>:value</code> attributes will change in the before and  after events.</li>
</ul><h2 id="h5357">Detecting EAP at runtime</h2><p>If you need to detect if you are running inside EAP or not, in addition to the <a href="immutant.util.html#var-in-container.3F">immutant.util/in-container?</a> function to let you know if you are in any container (WildFly or EAP), there is <a href="immutant.util.html#var-in-eap.3F">immutant.util/in-eap?</a>, which will only return <code>true</code> if you are running inside EAP.</p><h2 id="h5358">Doing it all from a profile</h2><p>If you want to only have these changes take effect when deploying to EAP, you can put them all in a lein profile:</p>
<pre><code>:profiles {:eap
           {:exclusions [org.hornetq/hornetq-jms-server org.hornetq/hornetq-server
                         org.jboss.narayana.jta/narayana-jta]
            :dependencies [[org.hornetq/hornetq-jms-server &quot;2.3.25.Final&quot;]
                           [org.hornetq/hornetq-server &quot;2.3.25.Final&quot;]
                           [org.jboss.jbossts.jta/narayana-jta &quot;4.17.29.Final&quot;]]
            :immutant {:war {:resource-paths [&quot;eap-resources&quot;]}}}}
</code></pre><p>where <code>eap-resources/</code> contains <code>WEB-INF/jboss-web.xml</code>. You would then apply this profile only when building a WAR file for EAP:</p>
<pre><code>lein with-profile +eap immutant war
</code></pre><p>For an example of an application that does this, see our <a href="https://github.com/immutant/feature-demo/">feature demo</a>.</p></div></div></div><script src="assets/jquery.syntax.min.js" type="text/javascript"></script><script src="assets/immutant.js" type="text/javascript"></script></body></html>