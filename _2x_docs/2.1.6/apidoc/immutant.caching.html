<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>immutant.caching documentation</title><link href="assets/immutant.css" rel="stylesheet" type="text/css"></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Immutant 2.1.6 API documentation</a></h1></div><div class="sidebar" id="namespaces"><div id="guides"><h3><a href="index.html"><span class="inner">Guides</span></a></h3><ul><li class="guide Migration-current"><a href="guide-migration.html"><div class="inner"><span>Migration</span></div></a></li><li class="guide Installation-current"><a href="guide-installation.html"><div class="inner"><span>Installation</span></div></a></li><li class="guide Web-current"><a href="guide-web.html"><div class="inner"><span>Web</span></div></a></li><li class="guide Messaging-current"><a href="guide-messaging.html"><div class="inner"><span>Messaging</span></div></a></li><li class="guide Scheduling-current"><a href="guide-scheduling.html"><div class="inner"><span>Scheduling</span></div></a></li><li class="guide Caching-current"><a href="guide-caching.html"><div class="inner"><span>Caching</span></div></a></li><li class="guide Transactions-current"><a href="guide-transactions.html"><div class="inner"><span>Transactions</span></div></a></li><li class="guide WildFly-current"><a href="guide-wildfly.html"><div class="inner"><span>WildFly</span></div></a></li><li class="guide EAP 6.4.x-current"><a href="guide-EAP.html"><div class="inner"><span>EAP 6.4.x</span></div></a></li><li class="guide Logging-current"><a href="guide-logging.html"><div class="inner"><span>Logging</span></div></a></li></ul></div><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>from</span></div></div></li><li class="depth-2"><a href="from.potemkin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>potemkin</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.collections.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>collections</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.macros.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macros</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.namespaces.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>namespaces</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.template.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>template</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.types.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>types</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li><li class="depth-3"><a href="from.potemkin.walk.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>walk</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -238px;"><span class="top" style="height: 247px;"></span><span class="bottom"></span></span><span>riddley</span></div></div></li><li class="depth-3 branch"><a href="from.riddley.compiler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compiler</span></div></a></li><li class="depth-3"><a href="from.riddley.walk.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>walk</span></div></a></li><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree" style="top: -362px;"><span class="top" style="height: 371px;"></span><span class="bottom"></span></span><span>immutant</span></div></div></li><li class="depth-2 current"><a href="immutant.caching.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caching</span></div></a></li><li class="depth-3 branch"><a href="immutant.caching.core-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-cache</span></div></a></li><li class="depth-3"><a href="immutant.caching.core-memoize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-memoize</span></div></a></li><li class="depth-2"><a href="immutant.codecs.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>codecs</span></div></a></li><li class="depth-3"><a href="immutant.codecs.fressian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fressian</span></div></a></li><li class="depth-2 branch"><a href="immutant.coercions.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>coercions</span></div></a></li><li class="depth-2 branch"><a href="immutant.daemons.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>daemons</span></div></a></li><li class="depth-2"><a href="immutant.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="immutant.messaging.hornetq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hornetq</span></div></a></li><li class="depth-3"><a href="immutant.messaging.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li><li class="depth-2"><a href="immutant.scheduling.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>scheduling</span></div></a></li><li class="depth-3 branch"><a href="immutant.scheduling.joda.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda</span></div></a></li><li class="depth-3"><a href="immutant.scheduling.quartz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>quartz</span></div></a></li><li class="depth-2"><a href="immutant.transactions.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>transactions</span></div></a></li><li class="depth-3 branch"><a href="immutant.transactions.jdbc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jdbc</span></div></a></li><li class="depth-3"><a href="immutant.transactions.scope.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scope</span></div></a></li><li class="depth-2 branch"><a href="immutant.util.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="immutant.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.sse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sse</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.ssl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ssl</span></div></a></li><li class="depth-3"><a href="immutant.web.undertow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>undertow</span></div></a></li><li class="depth-2"><a href="immutant.wildfly.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>wildfly</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="immutant.caching.html#var-add-listener.21"><div class="inner"><span>add-listener!</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-builder"><div class="inner"><span>builder</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-cache"><div class="inner"><span>cache</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-exists.3F"><div class="inner"><span>exists?</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-stop"><div class="inner"><span>stop</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-swap-in.21"><div class="inner"><span>swap-in!</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-with-codec"><div class="inner"><span>with-codec</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-with-expiration"><div class="inner"><span>with-expiration</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">immutant.caching</h2><div class="doc"><div class="markdown"><p>Create, manage and manipulate <a href="http://infinispan.org">Infinispan</a> caches in a data grid</p></div></div><div class="public anchor" id="var-add-listener.21"><h3>add-listener!</h3><div class="usage"><code>(add-listener! cache f type &amp; types)</code></div><div class="doc"><div class="markdown"><p>Attaches a listener fn to <code>cache</code> to be notified on certain events.</p><p>Infinispan&rsquo;s cache notifications API is based on Java annotations, which can be awkward in Clojure (and Java, for that matter).</p><p>This function provides the ability to be notified of cache events via single-arity callback functions taking an <a href="https://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/notifications/cachelistener/event/package-summary.html">Infinispan Event</a> instance.</p><p>Event types are represented as keywords corresponding to the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/notifications/cachelistener/annotation/package-summary.html">Infinispan annotations</a>:</p>
<ul>
  <li><code>:cache-entries-evicted</code></li>
  <li><code>:cache-entry-activated</code></li>
  <li><code>:cache-entry-created</code></li>
  <li><code>:cache-entry-invalidated</code></li>
  <li><code>:cache-entry-loaded</code></li>
  <li><code>:cache-entry-modified</code></li>
  <li><code>:cache-entry-passivated</code></li>
  <li><code>:cache-entry-removed</code></li>
  <li><code>:cache-entry-visited</code></li>
  <li><code>:data-rehashed</code></li>
  <li><code>:topology-changed</code></li>
  <li><code>:transaction-completed</code></li>
  <li><code>:transaction-registered</code></li>
</ul><p>The callbacks are synchronous, i.e. invoked on the thread acting on the cache. For longer running callbacks, use a queue or some sort of asynchronous channel.</p><p>The return value is a sequence of listener objects corresponding to the requested event types, which will be a subset of those returned from the cache&rsquo;s own <code>getListeners</code> method. These may be passed to the cache&rsquo;s <code>removeListener</code> method to turn off notifications.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/caching/src/immutant/caching.clj#L198">view source</a></div></div><div class="public anchor" id="var-builder"><h3>builder</h3><div class="usage"><code>(builder &amp; options)</code></div><div class="doc"><div class="markdown"><p>For advanced use, call this function to obtain a &ldquo;fluent&rdquo; <a href="https://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/configuration/cache/ConfigurationBuilder.html">ConfigurationBuilder</a>. Set the desired options, and invoke its build method, the result from which can be passed via the <code>:configuration</code> option of the <code><a href="immutant.caching.html#var-cache">cache</a></code> function. For example:</p>
<pre><code>(let [config (.. (builder <code>:ttl</code> [30 <code>:minutes</code>])
                clustering l1 (enabled true) build)]
  (cache &quot;L1&quot; <code>:configuration</code> config))
</code></pre><p>Note that builder takes the same options as <code><a href="immutant.caching.html#var-cache">cache</a></code> so you can concisely initialize it with Clojure, and use Java interop to set the more esoteric options</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/caching/src/immutant/caching.clj#L174">view source</a></div></div><div class="public anchor" id="var-cache"><h3>cache</h3><div class="usage"><code>(cache name &amp; opts)</code></div><div class="doc"><div class="markdown"><p>Returns a reference to the cache named by <code>name</code>, creating it if necessary.</p><p><code>name</code> is the only required argument. If a cache by that name already exists, it will be returned, and any options passed to this function will be ignored. To force reconfiguration, call <code><a href="immutant.caching.html#var-stop">stop</a></code> before calling <code><a href="immutant.caching.html#var-cache">cache</a></code>. The return value is a <a href="https://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/Cache.html">org.infinispan.Cache</a>, an extension of <code>java.util.concurrent.ConcurrentMap</code>.</p><p>The following groups of options are supported, each listed with its [default] value. A negative value for any numeric option means &ldquo;unlimited&rdquo;.</p><p>Durability: entries can persist to disk via the <code>:persist</code> option. If set to <code>true</code>, cache entries will persist in the current directory. Override this by setting <code>:persist</code> to a string naming the desired directory.</p>
<ul>
  <li><code>:persist</code> - if non-nil, data persists across server restarts in a  file store; a string value names the directory [nil]</li>
</ul><p>Eviction: turned off by default, <code>:max-entries</code> may be set to mitigate the risk of memory exhaustion. When <code>:persist</code> is enabled, evicted entries are written to disk, so that the entries in memory are a subset of those in the file store, transparently reloaded upon request. The eviction policy may be one of <code>:none</code>, <code>:lru</code>, <code>:lirs</code>, or <code>:unordered</code></p>
<ul>
  <li><code>:max-entries</code> - the max number of entries allowed in the cache [-1]</li>
  <li><code>:eviction</code> - how entries are evicted when <code>:max-entries</code> is exceeded [<code>:none</code>]</li>
</ul><p>Expiration: both time-to-live and max idle limits are supported. Values may be a number of milliseconds, a period keyword, or multiplier/keyword pairs, e.g. <code>[1 <code>:hour</code> 20 <code>:minutes</code>]</code>. Both singular and plural versions of <code>:second</code>, <code>:minute</code>, <code>:hour</code>, <code>:day</code>, and <code>:week</code> are valid period keywords.</p>
<ul>
  <li><code>:ttl</code> - the max time the entry will live before expiry [-1]</li>
  <li><code>:idle</code> - the time after which an entry will expire if not accessed [-1]</li>
</ul><p>Replication: the replication mode defaults to <code>:dist-sync</code> when clustered. When not clustered, the value of <code>:mode</code> is ignored, and the cache will be <code>:local</code>. Asynchronous replication may yield a slight performance increase at the risk of potential cache inconsistency.</p>
<ul>
  <li><code>:mode</code> - replication mode, one of <code>:local</code>,  <code>:repl-sync</code>, <code>:repl-async</code>, <code>:invalidation-sync</code>,  <code>:invalidation-async</code>, <code>:dist-sync</code>, <code>:dist-async</code> [<code>:dist-sync</code> or <code>:local</code>]</li>
</ul><p>Transactions: caches can participate in transactions when a TransactionManager is available. The locking scheme may be either <code>:optimistic</code> or <code>:pessimistic</code></p>
<ul>
  <li><code>:transactional?</code> - whether the cache is transactional [false]</li>
  <li><code>:locking</code> - transactional locking scheme [<code>:optimistic</code>]</li>
</ul><p>Advanced configuration: the options listed above are the most commonly configured, but Infinispan has many more buttons, switches, dials, knobs and levers. Call the <code><a href="immutant.caching.html#var-builder">builder</a></code> function to create your own Configuration instance and pass it in via the <code>:configuration</code> option.</p>
<ul>
  <li><code>:configuration</code> - a <a href="https://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/configuration/cache/Configuration.html">Configuration</a> instance</li>
</ul></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/caching/src/immutant/caching.clj#L27">view source</a></div></div><div class="public anchor" id="var-exists.3F"><h3>exists?</h3><div class="usage"><code>(exists? name)</code></div><div class="doc"><div class="markdown"><p>Return true if the named cache exists</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/caching/src/immutant/caching.clj#L162">view source</a></div></div><div class="public anchor" id="var-stop"><h3>stop</h3><div class="usage"><code>(stop cache-or-name)</code></div><div class="doc"><div class="markdown"><p>Removes a cache, allowing it to be reconfigured by the <code><a href="immutant.caching.html#var-cache">cache</a></code> function.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/caching/src/immutant/caching.clj#L167">view source</a></div></div><div class="public anchor" id="var-swap-in.21"><h3>swap-in!</h3><div class="usage"><code>(swap-in! cache key f &amp; args)</code></div><div class="doc"><div class="markdown"><p>Atomically swaps the value associated to the key in the cache with the result of applying f, passing the current value as the first param along with any args, returning the new cached value. Function f should have no side effects, as it may be called multiple times. If the key is missing, the result of applying f to nil will be inserted atomically.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/caching/src/immutant/caching.clj#L144">view source</a></div></div><div class="public anchor" id="var-with-codec"><h3>with-codec</h3><div class="usage"><code>(with-codec cache codec)</code></div><div class="doc"><div class="markdown"><p>Decorates <code>cache</code> with the codec named by <code>codec</code>.</p><p>Takes a cache and a keyword denoting a codec, and returns a new cache that applies that codec as entries are written/read to/from the passed cache. This is typically necessary only when non-clojure clients are sharing the cache. It&rsquo;s required if you wish to store nil keys or values. The provided codecs are <code><code>:edn</code></code> and <code><code>:json</code></code> (the latter requires you to depend on <code>cheshire</code>), and you can also use any other codecs you may have registered.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/caching/src/immutant/caching.clj#L102">view source</a></div></div><div class="public anchor" id="var-with-expiration"><h3>with-expiration</h3><div class="usage"><code>(with-expiration cache &amp; options)</code></div><div class="doc"><div class="markdown"><p>Decorates <code>cache</code> with the given expiration options.</p><p>The return value is a cache that will delegate any writes to the passed cache according to these options:</p>
<ul>
  <li><code>:ttl</code> - the max time the entry will live before expiry [-1]</li>
  <li><code>:idle</code> - the time after which an entry will expire if not accessed [-1]</li>
</ul><p>Options may be passed as either keyword arguments or in a map.</p><p>Negative values imply &ldquo;unlimited&rdquo;. Values may be a number of milliseconds, a period keyword, or multiplier/keyword pairs, e.g. <code>[1 <code>:hour</code> 20 <code>:minutes</code>]</code>. Both singular and plural versions of <code>:second</code>, <code>:minute</code>, <code>:hour</code>, <code>:day</code>, and <code>:week</code> are valid period keywords.</p><p>Expiration for existing entries in the passed cache will not be affected.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/caching/src/immutant/caching.clj#L117">view source</a></div></div></div></body></html>