<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>immutant.messaging documentation</title><link href="assets/immutant.css" rel="stylesheet" type="text/css"></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Immutant 2.1.6 API documentation</a></h1></div><div class="sidebar" id="namespaces"><div id="guides"><h3><a href="index.html"><span class="inner">Guides</span></a></h3><ul><li class="guide Migration-current"><a href="guide-migration.html"><div class="inner"><span>Migration</span></div></a></li><li class="guide Installation-current"><a href="guide-installation.html"><div class="inner"><span>Installation</span></div></a></li><li class="guide Web-current"><a href="guide-web.html"><div class="inner"><span>Web</span></div></a></li><li class="guide Messaging-current"><a href="guide-messaging.html"><div class="inner"><span>Messaging</span></div></a></li><li class="guide Scheduling-current"><a href="guide-scheduling.html"><div class="inner"><span>Scheduling</span></div></a></li><li class="guide Caching-current"><a href="guide-caching.html"><div class="inner"><span>Caching</span></div></a></li><li class="guide Transactions-current"><a href="guide-transactions.html"><div class="inner"><span>Transactions</span></div></a></li><li class="guide WildFly-current"><a href="guide-wildfly.html"><div class="inner"><span>WildFly</span></div></a></li><li class="guide EAP 6.4.x-current"><a href="guide-EAP.html"><div class="inner"><span>EAP 6.4.x</span></div></a></li><li class="guide Logging-current"><a href="guide-logging.html"><div class="inner"><span>Logging</span></div></a></li></ul></div><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>from</span></div></div></li><li class="depth-2"><a href="from.potemkin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>potemkin</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.collections.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>collections</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.macros.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macros</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.namespaces.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>namespaces</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.template.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>template</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.types.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>types</span></div></a></li><li class="depth-3 branch"><a href="from.potemkin.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li><li class="depth-3"><a href="from.potemkin.walk.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>walk</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -238px;"><span class="top" style="height: 247px;"></span><span class="bottom"></span></span><span>riddley</span></div></div></li><li class="depth-3 branch"><a href="from.riddley.compiler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compiler</span></div></a></li><li class="depth-3"><a href="from.riddley.walk.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>walk</span></div></a></li><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree" style="top: -362px;"><span class="top" style="height: 371px;"></span><span class="bottom"></span></span><span>immutant</span></div></div></li><li class="depth-2"><a href="immutant.caching.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caching</span></div></a></li><li class="depth-3 branch"><a href="immutant.caching.core-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-cache</span></div></a></li><li class="depth-3"><a href="immutant.caching.core-memoize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-memoize</span></div></a></li><li class="depth-2"><a href="immutant.codecs.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>codecs</span></div></a></li><li class="depth-3"><a href="immutant.codecs.fressian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fressian</span></div></a></li><li class="depth-2 branch"><a href="immutant.coercions.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>coercions</span></div></a></li><li class="depth-2 branch"><a href="immutant.daemons.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>daemons</span></div></a></li><li class="depth-2 current"><a href="immutant.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="immutant.messaging.hornetq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hornetq</span></div></a></li><li class="depth-3"><a href="immutant.messaging.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li><li class="depth-2"><a href="immutant.scheduling.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>scheduling</span></div></a></li><li class="depth-3 branch"><a href="immutant.scheduling.joda.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda</span></div></a></li><li class="depth-3"><a href="immutant.scheduling.quartz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>quartz</span></div></a></li><li class="depth-2"><a href="immutant.transactions.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>transactions</span></div></a></li><li class="depth-3 branch"><a href="immutant.transactions.jdbc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jdbc</span></div></a></li><li class="depth-3"><a href="immutant.transactions.scope.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scope</span></div></a></li><li class="depth-2 branch"><a href="immutant.util.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="immutant.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.sse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sse</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.ssl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ssl</span></div></a></li><li class="depth-3"><a href="immutant.web.undertow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>undertow</span></div></a></li><li class="depth-2"><a href="immutant.wildfly.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>wildfly</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="immutant.messaging.html#var-context"><div class="inner"><span>context</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-listen"><div class="inner"><span>listen</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-publish"><div class="inner"><span>publish</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-queue"><div class="inner"><span>queue</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-receive"><div class="inner"><span>receive</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-request"><div class="inner"><span>request</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-respond"><div class="inner"><span>respond</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-stop"><div class="inner"><span>stop</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-subscribe"><div class="inner"><span>subscribe</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-topic"><div class="inner"><span>topic</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-unsubscribe"><div class="inner"><span>unsubscribe</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">immutant.messaging</h2><div class="doc"><div class="markdown"><p>Easily publish and receive messages containing any type of nested data structure to dynamically-created queues and topics.</p></div></div><div class="public anchor" id="var-context"><h3>context</h3><div class="usage"><code>(context &amp; options)</code></div><div class="doc"><div class="markdown"><p>Creates a messaging context.</p><p>A context represents a remote or local connection to the messaging broker.</p><p>There are three reasons you would create a context rather than rely on the messaging functions to lazily create them as needed:</p>
<ol>
  <li>for communicating with a remote HornetQ instance</li>
  <li>for sharing a context among a batch of messaging operations</li>
  <li>for decoupling the client-id from the subscription name for  durable topic subscriptions (see <code><a href="immutant.messaging.html#var-subscribe">subscribe</a></code>)</li>
</ol><p>You are responsible for closing any contexts created via this function.</p><p>Options that apply to both local and remote contexts are [default]:</p>
<ul>
  <li><code>:client-id</code> - identifies the context for use with a durable topic  subscriber (see <code><a href="immutant.messaging.html#var-subscribe">subscribe</a></code>) [nil]</li>
  <li><code>:xa?</code> - if true, returns an XA context for use in a  distributed transaction [false]</li>
  <li><code>:mode</code> - one of: <code>:auto-ack</code>, <code>:client-ack</code>, <code>:transacted</code>. Ignored  if <code>:xa?</code> is true. [<code>:auto-ack</code>]</li>
</ul><p>Options that apply to only remote contexts are [default]:</p>
<ul>
  <li><code>:host</code> - the host of a remote broker [nil]</li>
  <li><code>:port</code> - the port of a remote broker [nil, 5445 if <code>:host</code> provided]</li>
  <li><code>:username</code> - a username for the remote broker [nil]</li>
  <li><code>:password</code> - the corresponding password for <code>:username</code> [nil]</li>
  <li><code>:remote-type</code> - when connecting to a HornetQ instance running  inside WildFly, this needs to be set to  <code>:hornetq-wildfly</code> [<code>:hornetq-standalone</code>]</li>
  <li><code>:reconnect-attempts</code> - total number of reconnect attempts to make  before giving up (-1 for unlimited) [0]</li>
  <li><code>:reconnect-retry-interval</code> - the period in milliseconds between subsequent  recontext attempts [2000]</li>
  <li><code>:reconnect-max-retry-interval</code> - the max retry interval that will be used [2000]</li>
  <li><code>:reconnect-retry-interval-multiplier</code> - a multiplier to apply to the time  since the last retry to compute the  time to the next retry [1.0]</li>
</ul></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/messaging/src/immutant/messaging.clj#L33">view source</a></div></div><div class="public anchor" id="var-listen"><h3>listen</h3><div class="usage"><code>(listen destination f &amp; options)</code></div><div class="doc"><div class="markdown"><p>Registers a single-arity function <code>f</code> to handle messages published to <code>destination</code>.</p><p>If a <code>:selector</code> is provided, then only messages having metadata/properties matching that expression will be received.</p><p>If given a <code>:context</code>, the context must be remote, and the mode of that context is ignored, since it is used solely to generate sub-contexts for each listener thread. Closing the given context will also close the listener.</p><p>The following options are supported [default]:</p>
<ul>
  <li><code>:concurrency</code> - the number of threads handling messages [1 for topics, #cores for queues]</li>
  <li><code>:selector</code> - A JMS (SQL 92) expression matching message metadata/properties [nil]</li>
  <li><code>:decode?</code> - if true, the decoded message body is passed to <code>f</code>. Otherwise, the  base message object is passed [true]</li>
  <li><code>:context</code> - a context for a <em>remote</em> broker; caller expected to close [nil]</li>
  <li><code>:mode</code> - the mode to use for the listener context. One of <code>:auto-ack</code>, <code>:client-ack</code>,  <code>:transacted</code> [<code>:transacted</code>]</li>
</ul><p>Note the default <code>:mode</code> is <code>:transacted</code>. This can lead to deadlock when <code><a href="immutant.messaging.html#var-publish">publish</a></code> or <code><a href="immutant.messaging.html#var-request">request</a></code> is invoked in the handler, since they will attempt to participate in the listener&rsquo;s transaction, which won&rsquo;t be committed until the handler completes. In this case, use either <code>:auto-ack</code> or an XA <code><a href="immutant.messaging.html#var-context">context</a></code>.</p><p>Returns a listener object that can be stopped by passing it to <code><a href="immutant.messaging.html#var-stop">stop</a></code>, or by calling .close on it.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/messaging/src/immutant/messaging.clj#L216">view source</a></div></div><div class="public anchor" id="var-publish"><h3>publish</h3><div class="usage"><code>(publish destination message &amp; options)</code></div><div class="doc"><div class="markdown"><p>Send a message to a destination.</p><p>If <code>message</code> has metadata, it will be transferred as headers and reconstituted upon receipt. Metadata keys must be valid Java identifiers (because they can be used in selectors) and can be overridden using the <code>:properties</code> option.</p><p>If no context is provided, a new one is created for each call, which can be inefficient if you are sending a large number of messages.</p><p>The following options are supported [default]:</p>
<ul>
  <li><code>:encoding</code> - one of: <code>:edn</code>, <code>:json</code>, <code>:none</code>, or other codec you&rsquo;ve registered [<code>:edn</code>]</li>
  <li><code>:priority</code> - 0-9, or one of: <code>:low</code>, <code>:normal</code>, <code>:high</code>, <code>:critical</code> [4]</li>
  <li><code>:ttl</code> - time to live, in millis [0 (forever)]</li>
  <li><code>:persistent?</code> - whether undelivered messages survive restarts [true]</li>
  <li><code>:properties</code> - a map to which selectors may be applied, overrides metadata [nil]</li>
  <li><code>:context</code> - a context to use; caller expected to close [nil]</li>
</ul></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/messaging/src/immutant/messaging.clj#L145">view source</a></div></div><div class="public anchor" id="var-queue"><h3>queue</h3><div class="usage"><code>(queue queue-name &amp; options)</code></div><div class="doc"><div class="markdown"><p>Establishes a handle to a messaging queue.</p><p>If given a <code>:context</code>, the context must be remote, and is remembered and used as a default option to any fn that takes a queue and a context.</p><p>This creates the queue if no <code>:context</code> is provided and it does not yet exist.</p><p>The following options are supported [default]:</p>
<ul>
  <li><code>:context</code> - a context for a <em>remote</em> broker. Cannot be specified  with any other options. [nil]</li>
</ul><p>Or:</p>
<ul>
  <li><code>:durable?</code> - whether messages persist across restarts [true]</li>
  <li><code>:selector</code> - a JMS (SQL 92) expression to filter published messages [nil]</li>
</ul></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/messaging/src/immutant/messaging.clj#L90">view source</a></div></div><div class="public anchor" id="var-receive"><h3>receive</h3><div class="usage"><code>(receive destination &amp; options)</code></div><div class="doc"><div class="markdown"><p>Receive a message from <code>destination</code>.</p><p>If a <code>:selector</code> is provided, then only messages having metadata/properties matching that expression may be received.</p><p>If no context is provided, a new one is created for each call, which can be inefficient if you are receiving a large number of messages.</p><p>The following options are supported [default]:</p>
<ul>
  <li><code>:timeout</code> - time in millis, after which the timeout-val is returned. 0  means wait forever, -1 means don&rsquo;t wait at all [10000]</li>
  <li><code>:timeout-val</code> - the value to return when a timeout occurs. Also returned when  a timeout of -1 is specified, and no message is available [nil]</li>
  <li><code>:selector</code> - A JMS (SQL 92) expression matching message metadata/properties [nil]</li>
  <li><code>:decode?</code> - if true, the decoded message body is returned. Otherwise, the  base message object is returned [true]</li>
  <li><code>:context</code> - a context to use; caller expected to close [nil]</li>
</ul></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/messaging/src/immutant/messaging.clj#L179">view source</a></div></div><div class="public anchor" id="var-request"><h3>request</h3><div class="usage"><code>(request queue message &amp; options)</code></div><div class="doc"><div class="markdown"><p>Send <code>message</code> to <code>queue</code> and return a Future that will retrieve the response.</p><p>Implements the request-response pattern, and is used in conjunction with <code><a href="immutant.messaging.html#var-respond">respond</a></code>.</p><p>It takes the same options as <code><a href="immutant.messaging.html#var-publish">publish</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/messaging/src/immutant/messaging.clj#L260">view source</a></div></div><div class="public anchor" id="var-respond"><h3>respond</h3><div class="usage"><code>(respond queue f &amp; options)</code></div><div class="doc"><div class="markdown"><p>Listen for messages on <code>queue</code> sent by the <code><a href="immutant.messaging.html#var-request">request</a></code> function and respond with the result of applying <code>f</code> to the message.</p><p>Accepts the same options as <code><a href="immutant.messaging.html#var-listen">listen</a></code>, along with [default]:</p>
<ul>
  <li><code>:ttl</code> - time for the response mesage to live, in millis [60000 (1 minute)]</li>
</ul><p>Note that <code><a href="immutant.messaging.html#var-listen">listen</a></code> and <code><a href="immutant.messaging.html#var-respond">respond</a></code> should not be called on the same queue.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/messaging/src/immutant/messaging.clj#L280">view source</a></div></div><div class="public anchor" id="var-stop"><h3>stop</h3><div class="usage"><code>(stop x)</code></div><div class="doc"><div class="markdown"><p>Stops the given context, destination, listener, or subscription listener.</p><p>Note that stopping a destination may remove it from the broker if called outside of the container.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/messaging/src/immutant/messaging.clj#L368">view source</a></div></div><div class="public anchor" id="var-subscribe"><h3>subscribe</h3><div class="usage"><code>(subscribe topic subscription-name f &amp; options)</code></div><div class="doc"><div class="markdown"><p>Sets up a durable subscription to <code>topic</code>, and registers a listener with <code>f</code>.</p><p><code>subscription-name</code> is used to identify the subscription, allowing you to stop the listener and resubscribe with the same name in the future without losing messages sent in the interim. The subscription is uniquely identified by the context&rsquo;s <code>:client-id</code> paired with the subscription name. If no <code>:context</code> is provided, a new context is created for this subscriber and the subscription name is used as the <code>:client-id</code> of the internally-created context. If a context is provided, it <em>must</em> have its <code>:client-id</code> set.</p><p>If a <code>:selector</code> is provided, then only messages having metadata/properties matching that expression may be received.</p><p>The following options are supported [default]:</p>
<ul>
  <li><code>:selector</code> - A JMS (SQL 92) expression matching message metadata/properties [nil]</li>
  <li><code>:decode?</code> - if true, the decoded message body is passed to <code>f</code>. Otherwise, the  javax.jms.Message object is passed [true]</li>
  <li><code>:context</code> - a context to use; caller expected to close [nil]</li>
</ul><p>Returns a listener object that can can be stopped by passing it to <code><a href="immutant.messaging.html#var-stop">stop</a></code>, or by calling .close on it.</p><p>Subscriptions should be torn down when no longer needed - see <code><a href="immutant.messaging.html#var-unsubscribe">unsubscribe</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/messaging/src/immutant/messaging.clj#L304">view source</a></div></div><div class="public anchor" id="var-topic"><h3>topic</h3><div class="usage"><code>(topic topic-name &amp; options)</code></div><div class="doc"><div class="markdown"><p>Establishes a handle to a messaging topic.</p><p>If given a <code>:context</code>, the context must be remote, and the context is remembered and used as a default option to any fn that takes a topic and a context.</p><p>This creates the topic if no <code>:context</code> is provided and it does not yet exist.</p><p>The following options are supported [default]:</p>
<ul>
  <li><code>:context</code> - a context for a <em>remote</em> broker [nil]</li>
</ul></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/messaging/src/immutant/messaging.clj#L120">view source</a></div></div><div class="public anchor" id="var-unsubscribe"><h3>unsubscribe</h3><div class="usage"><code>(unsubscribe topic subscription-name &amp; options)</code></div><div class="doc"><div class="markdown"><p>Tears down the durable topic subscription on <code>topic</code> named <code>subscription-name</code>.</p><p>The subscription is uniquely identified by the context&rsquo;s <code>:client-id</code> paired with the subscription name. If no <code>:context</code> is provided, a new context is created for this subscriber and the subscription name is used as the <code>:client-id</code> of the internally-created context. If a context is provided, it <em>must</em> have its <code>:client-id</code> set to the same value given to the context passed to <code><a href="immutant.messaging.html#var-subscribe">subscribe</a></code>.</p><p>The following options are supported [default]:</p>
<ul>
  <li><code>:context</code> - a context to use; caller expected to close [nil]</li>
</ul></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.6/messaging/src/immutant/messaging.clj#L343">view source</a></div></div></div></body></html>