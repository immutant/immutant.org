<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><link href="css/docs.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>immutant.scheduling documentation</title></head><body><div id="header"><h2><a href="http://immutant.org/">Immutant Home</a></h2><h1><a href="index.html">Immutant 2.0.0-alpha1</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>immutant</span></div></div></li><li class="depth-2"><a href="immutant.caching.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caching</span></div></a></li><li class="depth-3 branch"><a href="immutant.caching.core-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-cache</span></div></a></li><li class="depth-3"><a href="immutant.caching.core-memoize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-memoize</span></div></a></li><li class="depth-2 branch"><a href="immutant.codecs.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>codecs</span></div></a></li><li class="depth-2 branch"><a href="immutant.coercions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coercions</span></div></a></li><li class="depth-2 branch"><a href="immutant.daemons.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>daemons</span></div></a></li><li class="depth-2"><a href="immutant.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="immutant.messaging.hornetq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hornetq</span></div></a></li><li class="depth-3"><a href="immutant.messaging.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li><li class="depth-2 current"><a href="immutant.scheduling.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>scheduling</span></div></a></li><li class="depth-3"><a href="immutant.scheduling.joda.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda</span></div></a></li><li class="depth-2 branch"><a href="immutant.util.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="immutant.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.undertow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>undertow</span></div></a></li><li class="depth-3"><a href="immutant.web.websocket.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>websocket</span></div></a></li><li class="depth-2"><a href="immutant.wildfly.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>wildfly</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="immutant.scheduling.html#var-at"><div class="inner"><span>at</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-cron"><div class="inner"><span>cron</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-every"><div class="inner"><span>every</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-id"><div class="inner"><span>id</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-in"><div class="inner"><span>in</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-limit"><div class="inner"><span>limit</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-schedule"><div class="inner"><span>schedule</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-singleton"><div class="inner"><span>singleton</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-stop"><div class="inner"><span>stop</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-until"><div class="inner"><span>until</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">immutant.scheduling</h2><div class="doc"><p>Schedule jobs for execution</p></div><div class="public anchor" id="var-at"><h3>at</h3><div class="usage"><code>(at date)</code><code>(at ms)</code><code>(at HHmm)</code></div><div class="doc"><p>Takes a time after which the job will fire, so it will run immediately if the time is in the past; can be a <code>java.util.Date</code>, millis-since-epoch, or a String in <code>HH:mm</code> format. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/scheduling/src/immutant/scheduling.clj#L144">view source</a></div></div><div class="public anchor" id="var-cron"><h3>cron</h3><div class="usage"><code>(cron str)</code></div><div class="doc"><p>Takes a Quartz-style cron spec, e.g. <code>&#40;cron &quot;0 0 12 ? &#42; WED&quot;&#41;</code>, see the <a href='http://quartz-scheduler.org/documentation/quartz-2.2.x/tutorials/tutorial-lesson-06'>Quartz docs</a> for the syntax. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/scheduling/src/immutant/scheduling.clj#L170">view source</a></div></div><div class="public anchor" id="var-every"><h3>every</h3><div class="usage"><code>(every n)</code><code>(every kw)</code><code>(every n kw &amp; n-kws)</code></div><div class="doc"><p>Specifies a period between function calls, in milliseconds, a period keyword, or multiplier/keyword pairs, e.g. <code>&#40;every 1 <code>:hour</code> 20 <code>:minutes</code>&#41;</code>.  Both singular and plural versions of <code>:second</code>, <code>:minute</code>, <code>:hour</code>, <code>:day</code>, and <code>:week</code> are valid period keywords. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/scheduling/src/immutant/scheduling.clj#L150">view source</a></div></div><div class="public anchor" id="var-id"><h3>id</h3><div class="usage"><code>(id str)</code></div><div class="doc"><p>Takes a String or keyword to use as the unique id for the job. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/scheduling/src/immutant/scheduling.clj#L179">view source</a></div></div><div class="public anchor" id="var-in"><h3>in</h3><div class="usage"><code>(in n)</code><code>(in kw)</code><code>(in n kw &amp; n-kws)</code></div><div class="doc"><p>Specifies the period after which the job will fire, in milliseconds, a period keyword, or multiplier/keyword pairs, e.g. <code>&#40;in 5 <code>:minutes</code> 30 <code>:seconds</code>&#41;</code>. See <code><a href="immutant.scheduling.html#var-every">every</a></code> for the list of valid  period keywords. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/scheduling/src/immutant/scheduling.clj#L138">view source</a></div></div><div class="public anchor" id="var-limit"><h3>limit</h3><div class="usage"><code>(limit n)</code></div><div class="doc"><p>When <code><a href="immutant.scheduling.html#var-every">every</a></code> is specified, this limits the invocations by count, including the first one, e.g. <code>&#40;-&gt; &#40;every <code>:hour</code>&#41; &#40;limit 10&#41;&#41;</code>. When combined with <code><a href="immutant.scheduling.html#var-until">until</a></code>, whichever triggers first ends the iteration. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/scheduling/src/immutant/scheduling.clj#L164">view source</a></div></div><div class="public anchor" id="var-schedule"><h3>schedule</h3><div class="usage"><code>(schedule f &amp; spec)</code></div><div class="doc"><p>Schedules a function to run according to a specification composed from any of the following:</p><ul><li><code><a href="immutant.scheduling.html#var-in">in</a></code> - a period after which f will be called</li><li><code><a href="immutant.scheduling.html#var-at">at</a></code> - a time after which f will be called</li><li><code><a href="immutant.scheduling.html#var-every">every</a></code> - the period between calls</li><li><code><a href="immutant.scheduling.html#var-until">until</a></code> - stops the calls at a specific time</li><li><code><a href="immutant.scheduling.html#var-limit">limit</a></code> - limits the calls to a specific count</li><li><code><a href="immutant.scheduling.html#var-cron">cron</a></code> - calls f according to a <a href='http://quartz-scheduler.org/documentation/quartz-2.2.x/tutorials/tutorial-lesson-06'>Quartz-style</a> cron spec</li></ul><p>Units for periods are milliseconds, but can also be represented as a keyword or a sequence of multiplier/keyword pairs, e.g. <code>&#91;1 <code>:week</code>, 4 <code>:days</code>, 2 <code>:hours</code>, 30 <code>:minutes</code>, 59 <code>:seconds</code>&#93;</code>. See <code><a href="immutant.scheduling.html#var-every">every</a></code> for the list of valid period keywords.</p><p>Time values can be a <code>java.util.Date</code>, a long denoting milliseconds-since-epoch, or a String in <code>HH:mm</code> format, interpreted as the next occurence of "HH:mm:00" in the currently active timezone.</p><p>For example:</p><pre>
&#40;schedule #&#40;prn 'fire!&#41;
  &#40;-&gt; &#40;in 5 <code>:minutes</code>&#41;
    &#40;every 2 <code>:hours</code>, 30 <code>:minutes</code>&#41;
    &#40;until &quot;1730&quot;&#41;&#41;&#41;

&#40;schedule #&#40;prn 'fire!&#41;
  &#40;-&gt; &#40;at some-date&#41;
    &#40;every <code>:second</code>&#41;
    &#40;limit 60&#41;&#41;&#41;
</pre><p>Ultimately, the spec is just a map, and the syntactic sugar functions are just assoc'ing keys corresponding to their names. The map can be passed either explicitly or via keyword arguments. All of the following are equivalent:</p><pre>
&#40;schedule #&#40;prn 'fire!&#41; &#40;-&gt; &#40;in 5 <code>:minutes</code>&#41; &#40;every <code>:day</code>&#41;&#41;&#41;
&#40;schedule #&#40;prn 'fire!&#41; {<code>:in</code> &#91;5 <code>:minutes</code>&#93;, <code>:every</code> <code>:day</code>}&#41;
&#40;schedule #&#40;prn 'fire!&#41; <code>:in</code> &#91;5 <code>:minutes</code>&#93;, <code>:every</code> <code>:day</code>&#41;
</pre><p>Two additional options may be passed in the spec:</p><ul><li><code>:id</code> - a unique identifier for the scheduled job</li><li><code>:singleton</code> - a boolean denoting the job's behavior in a cluster <em>[true]</em></li></ul><p>If called with an <code>:id</code> that has already been scheduled, the prior job will be replaced. If an id is not provided, a UUID is used instead.</p><p>The return value is a map of the options with any missing defaults filled in, including a generated id if necessary.</p><p>You can pass additional options that will be passed on to the scheduler. Currently, the only scheduler option is:</p><ul><li><code>:num-threads</code> Specifies the number of worker threads for the scheduler's               thread pool <em>[5]</em></li></ul><p>The scheduler options also define which scheduler to use, so if you don't pass any with a <code>schedule</code> call, you'll get the default scheduler configured with the default options. If you pass scheduler options on a subsequent call, you will get a different scheduler configured with those options. The same scheduler will be used for any future <code>schedule</code> calls with those same scheduler options.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/scheduling/src/immutant/scheduling.clj#L27">view source</a></div></div><div class="public anchor" id="var-singleton"><h3>singleton</h3><div class="usage"><code>(singleton boolean)</code></div><div class="doc"><p>If true (the default), only one instance of a given job name will run in a cluster. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/scheduling/src/immutant/scheduling.clj#L175">view source</a></div></div><div class="public anchor" id="var-stop"><h3>stop</h3><div class="usage"><code>(stop key value &amp; key-values)</code><code>(stop options)</code></div><div class="doc"><p>Unschedule a scheduled job.</p><p>Options can be passed as either a map or kwargs, but is typically the map returned from a <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code> call. If there are no jobs remaining on the scheduler the scheduler itself is stopped. Returns true if a job was actually removed.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/scheduling/src/immutant/scheduling.clj#L116">view source</a></div></div><div class="public anchor" id="var-until"><h3>until</h3><div class="usage"><code>(until date)</code><code>(until ms)</code><code>(until HHmm)</code></div><div class="doc"><p>When <code><a href="immutant.scheduling.html#var-every">every</a></code> is specified, this limits the invocations by time; can be a <code>java.util.Date</code>, millis-since-epoch, or a String in <code>HH:mm</code> format, e.g. <code>&#40;-&gt; &#40;every <code>:hour</code>&#41; &#40;until &quot;17:00&quot;&#41;&#41;</code>. When combined with <code><a href="immutant.scheduling.html#var-limit">limit</a></code>, whichever triggers first ends the iteration. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/scheduling/src/immutant/scheduling.clj#L157">view source</a></div></div></div></body></html>